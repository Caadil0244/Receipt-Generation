{% extends "base.html" %}

{% block title %}View Receipt{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h2 class="text-success mb-3">
            <i class="fas fa-file-invoice-dollar me-2"></i>Receipt Details
        </h2>
    </div>
</div>

<div class="card card-green">
    <div class="card-body">
        <h5 class="card-title">Receipt Number: {{ receipt.receipt_number }}</h5>
        <p class="card-text"><strong>Customer Name:</strong> {{ receipt.customer.name }}</p>
        <p class="card-text"><strong>Customer Phone:</strong> {{ receipt.customer.phone or 'N/A' }}</p>
        <p class="card-text"><strong>Amount Paid:</strong> ${{ "%.2f"|format(receipt.amount_paid) }}</p>
        <p class="card-text"><strong>Balance:</strong> ${{ "%.2f"|format(receipt.balance) }}</p>
        <p class="card-text"><strong>Receipt Date:</strong> {{ receipt.receipt_date.strftime('%Y-%m-%d') }}</p>

        <hr>

        <div class="d-flex justify-content-between">
            <div class="btn-group" role="group">
                <a href="{{ url_for('generate_receipt_pdf', receipt_id=receipt.id) }}" class="btn btn-sm btn-outline-danger me-2">
                    <i class="fas fa-file-pdf me-1"></i> Download PDF
                </a>
                <a href="{{ url_for('generate_receipt_doc', receipt_id=receipt.id) }}" class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-file-word me-1"></i> Download DOC
                </a>
            </div>
            <div>
                <a href="{{ url_for('edit_receipt', receipt_id=receipt.id) }}" class="btn btn-sm btn-warning me-2">
                    <i class="fas fa-edit me-1"></i> Edit
                </a>
                <button type="button" class="btn btn-sm btn-danger" onclick="deleteReceipt('{{ receipt.id }}')">
                    <i class="fas fa-trash-alt me-1"></i> Delete
                </button>
            </div>
        </div>
    </div>
</div>

<div class="mt-4">
    <a href="{{ url_for('view_payments') }}" class="btn btn-secondary">
        <i class="fas fa-arrow-left me-2"></i>Back to Payments
    </a>
</div>

<script>
function deleteReceipt(receiptId) {
    if (confirm('Are you sure you want to delete this receipt?')) {
        fetch(`/delete_receipt/${receiptId}`, {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Receipt deleted successfully!');
                window.location.href = "{{ url_for('view_payments') }}";
            } else {
                alert('Error deleting receipt: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while deleting the receipt.');
        });
    }
}
</script>
{% endblock %}
